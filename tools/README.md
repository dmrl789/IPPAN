# IPPAN Tools

This directory contains utility scripts for maintaining and managing the IPPAN project.

## Available Tools

### `update_dashboard.py`

Automated script to update the project readiness dashboard with latest metrics.

#### Features

- Parses tarpaulin coverage reports (XML format)
- Calculates CI success rate from GitHub Actions API
- Updates `PRODUCTION_READINESS_STATUS.md` with automated metrics
- Generates dynamic progress tracking
- Provides crate-level coverage breakdown

#### Usage

```bash
# Basic usage (uses default paths)
python3 tools/update_dashboard.py

# With custom coverage file
python3 tools/update_dashboard.py coverage/cobertura.xml

# With all options
python3 tools/update_dashboard.py coverage/cobertura.xml \
  --status-file PRODUCTION_READINESS_STATUS.md \
  --ci-success-rate 0.87 \
  --repo ippan-io/ippan
```

#### Parameters

- `coverage_xml` (optional): Path to tarpaulin coverage XML report
  - Default: `coverage/cobertura.xml`
  
- `--status-file` (optional): Path to status markdown file to update
  - Default: `PRODUCTION_READINESS_STATUS.md`
  
- `--ci-success-rate` (optional): Override CI success rate (0.0-1.0)
  - If not provided, will query GitHub API using `GITHUB_TOKEN`
  
- `--repo` (optional): GitHub repository in format `owner/repo`
  - Default: `ippan-io/ippan`

#### Environment Variables

- `GITHUB_TOKEN`: Required for fetching CI success rate from GitHub API
  - Automatically available in GitHub Actions workflows
  - For local use, create a personal access token with `repo` scope

#### Output

The script generates a readiness dashboard section with:

- Overall status indicator (ðŸŸ¢/ðŸŸ¡/ðŸ”´)
- Key metrics table (coverage, CI success rate, ready crates)
- Coverage breakdown by crate
- Readiness categories

#### Example Output

```markdown
## ðŸ“Š Automated Readiness Dashboard

> **Last Updated**: 2025-11-11 12:00:00 UTC
> **Generated by**: Automated Dashboard Bot

### Overall Status: ðŸŸ¢ GOOD

| Metric | Value | Target | Status |
|--------|-------|--------|--------|
| **Test Coverage** | 85.3% | â‰¥80% | âœ… |
| **CI Success Rate** | 92.0% | â‰¥90% | âœ… |
| **Production-Ready Crates** | 16/20 | â‰¥15/20 | âœ… |

### Coverage by Crate

| Crate | Coverage | Lines | Status |
|-------|----------|-------|--------|
| `ippan-crypto` | 89.2% | 245/275 | âœ… |
| `ippan-core` | 82.1% | 156/190 | âœ… |
...
```

## Automated Workflows

### Weekly Dashboard Update

The dashboard is automatically updated weekly via the GitHub Actions workflow:

- **Workflow**: `.github/workflows/readiness-dashboard.yml`
- **Schedule**: Every Monday at 00:00 UTC
- **Triggers**: 
  - Weekly cron schedule
  - Manual dispatch
  - Push to main (for crate changes)

### Workflow Steps

1. Checkout repository
2. Install Rust and system dependencies
3. Run tarpaulin coverage analysis
4. Calculate CI success rate from recent workflow runs
5. Update `PRODUCTION_READINESS_STATUS.md`
6. Commit and push changes (if any)
7. Upload coverage artifacts

### Manual Trigger

You can manually trigger the workflow from the GitHub Actions UI:

1. Navigate to **Actions** tab
2. Select **Readiness Dashboard Update** workflow
3. Click **Run workflow**
4. Choose branch and click **Run workflow**

## Development

### Adding New Metrics

To add new metrics to the dashboard:

1. Update `update_dashboard.py` to calculate the new metric
2. Modify `generate_readiness_table()` to include the metric in output
3. Update the workflow to collect any required data
4. Test locally before deploying

### Testing Locally

```bash
# Create a test coverage file
mkdir -p test_coverage
# ... generate coverage ...

# Run the script
python3 tools/update_dashboard.py test_coverage/cobertura.xml \
  --status-file test_coverage/TEST_STATUS.md \
  --ci-success-rate 0.85

# Inspect the output
cat test_coverage/TEST_STATUS.md
```

### Dependencies

The script requires only Python 3.7+ standard library modules:
- `xml.etree.ElementTree` - XML parsing
- `argparse` - CLI argument parsing
- `json` - JSON parsing for API responses
- `urllib.request` - HTTP requests for GitHub API
- `datetime` - Timestamp generation
- `re` - Regular expressions for text replacement

## Maintenance

### Updating Crate Categories

Crate categories are defined at the top of `update_dashboard.py`:

```python
PRODUCTION_READY_CRATES = {
    "ippan-crypto",
    "ippan-types", 
    "ippan-time",
}

PARTIALLY_READY_CRATES = {
    "ippan-core",
    "ippan-network",
}

CRITICAL_CRATES = {
    "ippan-economics",
    "ippan-ai-core",
    "ippan-consensus",
    "ippan-governance",
}
```

Update these sets as crates mature or new critical crates are added.

### Adjusting Thresholds

Status thresholds can be adjusted in the `generate_readiness_table()` function:

```python
# Current thresholds
if overall_rate >= 0.80 and ci_success_rate >= 0.90:
    status_icon = "ðŸŸ¢"
    status_text = "GOOD"
elif overall_rate >= 0.60 and ci_success_rate >= 0.75:
    status_icon = "ðŸŸ¡"
    status_text = "FAIR"
else:
    status_icon = "ðŸ”´"
    status_text = "NEEDS WORK"
```

## Troubleshooting

### Coverage File Not Found

If the coverage file is not found, ensure:
1. Tarpaulin has run successfully
2. The output path matches the expected location
3. The workflow has correct file paths

### GitHub API Rate Limiting

If you encounter rate limiting issues:
1. Ensure `GITHUB_TOKEN` is properly configured
2. The token has sufficient permissions (`repo` scope)
3. Consider caching CI metrics between runs

### Dashboard Not Updating

Check:
1. Workflow is enabled in repository settings
2. Bot user has write permissions to the repository
3. Check workflow logs for errors
4. Verify the commit is not blocked by branch protection rules

## Contributing

When adding new tools:

1. Document the tool in this README
2. Add help text (`--help` flag)
3. Include example usage
4. Add appropriate error handling
5. Write unit tests if applicable

---

*Maintained by the IPPAN Core Team*
