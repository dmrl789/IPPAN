groups:
- name: ippan.testnet.rules
  rules:
  # Node Health Rules
  - alert: IppanTestnetNodeDown
    expr: up{job="ippan-testnet-nodes"} == 0
    for: 1m
    labels:
      severity: critical
      network: testnet
    annotations:
      summary: "IPPAN Testnet node is down"
      description: "IPPAN testnet node {{ $labels.instance }} has been down for more than 1 minute."

  - alert: IppanTestnetNodeHighCPU
    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet node high CPU usage"
      description: "CPU usage is above 80% on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetNodeHighMemory
    expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes > 0.9
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet node high memory usage"
      description: "Memory usage is above 90% on testnet node {{ $labels.instance }}."

  # Network Rules
  - alert: IppanTestnetNetworkPartition
    expr: count(up{job="ippan-testnet-nodes"} == 1) < 3
    for: 2m
    labels:
      severity: critical
      network: testnet
    annotations:
      summary: "IPPAN Testnet network partition detected"
      description: "Less than 3 testnet nodes are online, possible network partition."

  - alert: IppanTestnetLowPeerCount
    expr: ippan_network_peers < 2
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet node has low peer count"
      description: "Testnet node {{ $labels.instance }} has less than 2 peers."

  # Consensus Rules
  - alert: IppanTestnetConsensusFailure
    expr: ippan_consensus_failures_total > 0
    for: 0m
    labels:
      severity: critical
      network: testnet
    annotations:
      summary: "IPPAN Testnet consensus failure"
      description: "Consensus failure detected on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetBlockProductionStalled
    expr: time() - ippan_consensus_last_block_timestamp > 60
    for: 1m
    labels:
      severity: critical
      network: testnet
    annotations:
      summary: "IPPAN Testnet block production stalled"
      description: "No new blocks produced for more than 60 seconds on testnet."

  - alert: IppanTestnetHighBlockTime
    expr: ippan_consensus_block_time_seconds > 30
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet high block time"
      description: "Block time is above 30 seconds on testnet node {{ $labels.instance }}."

  # API Rules
  - alert: IppanTestnetAPIHighErrorRate
    expr: rate(http_requests_total{job="ippan-testnet-api",status=~"5.."}[5m]) > 0.1
    for: 2m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet API high error rate"
      description: "API error rate is {{ $value }} errors per second on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetAPIHighLatency
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job="ippan-testnet-api"}[5m])) > 2
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet API high latency"
      description: "API 95th percentile latency is {{ $value }}s on testnet node {{ $labels.instance }}."

  # Storage Rules
  - alert: IppanTestnetStorageHighUsage
    expr: ippan_storage_usage_percent > 90
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet storage high usage"
      description: "Storage usage is above 90% on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetStorageIOError
    expr: rate(ippan_storage_io_errors_total[5m]) > 0
    for: 1m
    labels:
      severity: critical
      network: testnet
    annotations:
      summary: "IPPAN Testnet storage IO error"
      description: "Storage IO errors detected on testnet node {{ $labels.instance }}."

  # Mining Rules
  - alert: IppanTestnetMiningStopped
    expr: ippan_mining_active == 0
    for: 2m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet mining stopped"
      description: "Mining has stopped on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetLowHashRate
    expr: ippan_mining_hash_rate < 1000
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet low hash rate"
      description: "Hash rate is below 1000 H/s on testnet node {{ $labels.instance }}."

  # Transaction Rules
  - alert: IppanTestnetTransactionPoolFull
    expr: ippan_transaction_pool_size > 10000
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet transaction pool full"
      description: "Transaction pool has more than 10000 transactions on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetTransactionProcessingSlow
    expr: rate(ippan_transactions_processed_total[5m]) < 10
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet transaction processing slow"
      description: "Transaction processing rate is below 10 TPS on testnet node {{ $labels.instance }}."

  # Wallet Rules
  - alert: IppanTestnetWalletBalanceLow
    expr: ippan_wallet_balance < 1000
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet wallet balance low"
      description: "Wallet balance is below 1000 tokens on testnet node {{ $labels.instance }}."

  # Database Rules
  - alert: IppanTestnetDatabaseConnectionError
    expr: rate(ippan_database_connection_errors_total[5m]) > 0
    for: 1m
    labels:
      severity: critical
      network: testnet
    annotations:
      summary: "IPPAN Testnet database connection error"
      description: "Database connection errors detected on testnet node {{ $labels.instance }}."

  - alert: IppanTestnetDatabaseSlowQuery
    expr: histogram_quantile(0.95, rate(ippan_database_query_duration_seconds_bucket[5m])) > 5
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet database slow query"
      description: "Database 95th percentile query time is {{ $value }}s on testnet node {{ $labels.instance }}."

  # Testnet Specific Rules
  - alert: IppanTestnetFaucetEmpty
    expr: ippan_faucet_balance < 10000
    for: 5m
    labels:
      severity: warning
      network: testnet
    annotations:
      summary: "IPPAN Testnet faucet balance low"
      description: "Testnet faucet balance is below 10000 tokens."

  - alert: IppanTestnetHighTestTransactionRate
    expr: rate(ippan_test_transactions_total[5m]) > 100
    for: 5m
    labels:
      severity: info
      network: testnet
    annotations:
      summary: "IPPAN Testnet high test transaction rate"
      description: "High rate of test transactions detected: {{ $value }} TPS."
