# üß≠ IPPAN Multi-Agent Contribution Protocol

### Version 1.0 ¬∑ Last Updated 2025-01-25

---

## 1. Overview

This repository is actively developed by a **hybrid network of human engineers and autonomous agents**.
To maintain determinism, build integrity, and clean history across all crates, every contribution must follow the rules below.

---

## 2. Branching Model

| Purpose                | Branch Name           | Notes                                              |
| ---------------------- | --------------------- | -------------------------------------------------- |
| Main production branch | `main`                | Protected ‚Äî only maintainers merge here.           |
| Integration / staging  | `dev`                 | Optional buffer for testing multiple PRs together. |
| Agent or feature work  | `agent/<name>-<task>` | e.g. `agent/alpha-add-hashtimer-tests`             |
| Hotfix                 | `fix/<short-desc>`    | Small, urgent patches only.                        |
| Documentation          | `docs/<topic>`        | Whitepapers, PRDs, specs.                          |

‚û° Never commit directly to `main` or `dev`.

---

## 3. Pull Requests (PRs)

1. **One PR per logical change** (max ‚âà 500 LOC).
2. PR title = short imperative sentence.

   * ‚úÖ `feat: add DAG-Fair emission reward calculator`
   * ‚ùå `added code changes`
3. Link related issue(s) using `Closes #123` or `Refs #456`.
4. Label the PR with:

   * `agent-alpha`, `agent-beta`, ‚Ä¶ or your human name
   * `crate:<crate-name>`
   * `type:feat | fix | refactor | docs`
5. Ensure CI passes:

   ```bash
   cargo fmt --all -- --check
   cargo clippy --all -- -D warnings
   cargo test --workspace
   cargo deny check
   ```
6. Use **Draft PRs** for WIP branches; mark **Ready for Review** when stable.

---

## 4. Commit Convention

Follow **Conventional Commits**:

```
<type>(<scope>): <description>
```

Examples:

```
feat(consensus): implement validator rotation
fix(network): repair libp2p bootstrap bug
refactor(core): simplify amount serialization
```

Types = `feat`, `fix`, `refactor`, `docs`, `test`, `chore`.

---

## 5. Merge Rules

* Only **maintainers or the meta-agent** can merge into `main`.
* Require:

  * ‚úÖ All CI checks green
  * ‚úÖ At least one review (human or verified orchestrator)
* **No fast-forward merges** ‚Äî always **squash** to keep history linear.
* Delete the feature branch after merge (auto-cleanup runs nightly).

---

## 6. Agent Coordination

1. Each agent must declare its **scope** in `/AGENTS.md`:

   ```markdown
   ### Agent Alpha
   - Scope: `crates/consensus`, `crates/economics`
   - Maintainer: Ugo Giuliani
   ```
2. Agents work **only within their assigned scopes**.
3. Overlaps trigger the **MetaAgent** to reassign or merge tasks.
4. The orchestrator may lock crates during sensitive merges.

---

## 7. Conflict Resolution Workflow

1. The PR bot attempts auto-rebase (`cursoragent resolve conflicts`).
2. If conflicts persist:

   ```bash
   git fetch origin main
   git rebase origin/main
   ```

   Resolve manually, then:

   ```bash
   git add .
   git rebase --continue
   git push --force-with-lease
   ```
3. The MetaAgent monitors repeated conflicts and suggests crate isolation.

---

## 8. Documentation & Spec Alignment

Every new feature must include:

* A short **design note** in `/docs/notes/<feature>.md`
* Updated **README.md** inside the affected crate
* Updated **CHANGELOG.md** entry

---

## 9. Automated Checks (CI/CD)

The CI pipeline runs:

1. `cargo fmt`, `clippy`, `test`, `deny`
2. Security scan (`trivy fs .`)
3. Linting for SPDX license headers
4. Optional: coverage ‚â• 70 %

PRs failing any step are blocked automatically.

---

## 10. Meta-Agent Roles

| Role                  | Responsibility                                |
| --------------------- | --------------------------------------------- |
| **CursorAgent**       | Local code changes, conflict fixes            |
| **MetaAgent**         | Task allocation, dependency awareness         |
| **DocsAgent**         | PRD, spec, and whitepaper synchronization     |
| **AuditAgent**        | Security and deterministic build verification |
| **Human Maintainers** | Final merge approval and release management   |

---

## 11. Release Protocol

1. Bump version in root `Cargo.toml`.
2. Tag with `vX.Y.Z`.
3. Changelog auto-generated by the release workflow.
4. Docker image pushed to `ghcr.io/dmrl789/ippan`.

---

## 12. Communication Channels

* **GitHub Issues** ‚Üí primary coordination
* **PR comments** ‚Üí technical discussion only
* **/docs/roadmap.md** ‚Üí tracks active milestones
* Optional: matrix/discord for synchronous discussions

---

## 13. Golden Rules

1. üß© Commit small, merge fast.
2. üß† No crate-wide refactors without RFC.
3. üßÆ Keep all code deterministic and reproducible.
4. üõë Never merge if you don't understand the build impact.
5. ‚öñÔ∏è The network's integrity > individual productivity.

---

## 14. License & Attribution

All contributions are licensed under the repository's root `LICENSE`.
Agents must preserve author metadata (`Co-authored-by` lines) to maintain IP traceability.

---

## 15. Quick Start for New Contributors

### For Human Contributors:
1. Fork the repository
2. Create a feature branch: `git checkout -b feature/your-feature-name`
3. Make your changes following the commit conventions
4. Run tests locally: `cargo test --workspace`
5. Push and create a PR with proper labels

### For AI Agents:
1. Use the `/codex plan` command to outline your approach
2. Create a branch following the `agent/<name>-<task>` pattern
3. Implement changes within your assigned scope
4. Ensure all automated checks pass
5. Request review from the appropriate maintainer

---

## 16. Troubleshooting

### Common Issues:
- **Build failures**: Check `rust-toolchain.toml` for version requirements
- **Test failures**: Run `cargo test --verbose` for detailed output
- **Merge conflicts**: Follow the conflict resolution workflow in section 7
- **Permission issues**: Contact maintainers for repository access

### Getting Help:
- Check existing issues and PRs for similar problems
- Use GitHub Discussions for general questions
- Tag relevant maintainers in PR comments for specific guidance

---

## 17. Related Documentation

* **[AGENTS.md](./AGENTS.md)** ‚Äì Complete agent roster, slash commands, and operational playbooks
* **[README.md](./README.md)** ‚Äì Project overview and quick start
* **[docs/](./docs/)** ‚Äì Architecture decisions, PRDs, and technical specs

For questions about agent coordination, deployment, or CI/CD, see [AGENTS.md](./AGENTS.md) sections 1-9.

---

**Maintainers:** This protocol evolves with the project. Update accordingly and notify all agents via `/sync-docs`.
