name: ðŸ§¹ Auto PR & Branch Cleanup

on:
  schedule:
    - cron: '0 2 * * *' # Every day at 02:00 UTC
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ§­ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ§¹ Delete merged branches
        uses: devops-infra/action-delete-branch@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          delete_protected: false
          exclude: |
            main
            dev
          only_merged: true
          dry_run: false

      - name: ðŸ•“ Prune stale branches (>10 days inactive)
        uses: vdemedes/prune-branches@v2
        with:
          days_old: 10
          exclude: main,dev
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ§  Comment summary
        run: |
          echo "âœ… Branch cleanup completed on $(date -u)"