- name: DNS/HTTPS sanity
  run: |
    set -e
    echo "UI: $UI_URL"
    curl -fsSLI "$UI_URL" >/dev/null
    tries=0
    until [ $tries -ge 3 ]; do
      if curl -fsSL "$API_BASE/health" | tee health.json && jq -e '.status==\"healthy\"' health.json >/dev/null; then
        exit 0
      else
        echo "Health check failed, retrying in 5 seconds... ($((tries+1))/3)"
        sleep 5
        tries=$((tries+1))
      fi
    done
    echo "::error::API health endpoint failed after 3 attempts"
    curl -i "$API_BASE/health" || true
    exit 1
